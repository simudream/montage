var global=window;(function(e,t){typeof exports=="object"?module.exports=t(global):typeof define=="function"&&define.amd?define([],function(){return t(e)}):t(e)})(this,function(e){"use strict";function r(e){return Math.abs(e)>.35?e:0}var t,n;return t=function(e){this._distance=vec3.createFrom(0,0,-32),this._center=vec3.create(),this._viewMat=mat4.create(),this._yUp=!0,this.orbitX=0,this.orbitY=0,this.maxOrbitX=Math.PI*.5,this.minOrbitX=-Math.PI*.5,this.maxOrbitY=Math.PI,this.minOrbitY=-Math.PI,this.constrainXOrbit=!0,this.constrainYOrbit=!1,this.maxDistance=512,this.minDistance=16,this.distanceStep=1,this.constrainDistance=!0,this._dirty=!0,this._hookEvents(e)},t.prototype._hookEvents=function(e){var t=this,n=!1,r,i;e.addEventListener("mousedown",function(e){e.which===1&&(n=!0),r=e.pageX,i=e.pageY},!1),e.addEventListener("mousemove",function(e){if(n){var s=e.pageX-r,o=e.pageY-i;r=e.pageX,i=e.pageY,t.orbit(s*.013,o*.013)}},!1),e.addEventListener("mouseup",function(){n=!1},!1),e.addEventListener("mousewheel",function(e){t.setDistance(-t._distance[2]+e.wheelDeltaY*t.distanceStep),e.preventDefault()},!1),e.addEventListener("touchstart",function(e){var t=e.touches;switch(t.length){case 1:n=!0,r=t[0].pageX,i=t[0].pageY;break;case 2:break;default:return}e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("touchmove",function(e){var s=e.touches;if(n){var o=s[0].pageX-r,u=s[0].pageY-i;r=s[0].pageX,i=s[0].pageY,t.orbit(o*.005,u*.005)}e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("touchend",function(e){n=!1,e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("gesturestart",function(e){n=!1,t.initialDistance=t._distance[2],e.preventDefault()},!1),e.addEventListener("gesturechange",function(e){document.getElementsByTagName("header")[0].innerHTML=e.scale+" "+t.initialDistance+" "+t.initialDistance*e.scale,t.setDistance(t.initialDistance*e.scale*100),e.preventDefault()},!1),e.addEventListener("gestureend",function(e){e.preventDefault()},!1)},t.prototype.orbit=function(e,t){if(e||t){this.orbitY+=e;if(this.constrainYOrbit)this.orbitY=Math.min(Math.max(this.orbitY,this.minOrbitY),this.maxOrbitY);else{while(this.orbitY<-Math.PI)this.orbitY+=Math.PI*2;while(this.orbitY>=Math.PI)this.orbitY-=Math.PI*2}this.orbitX+=t;if(this.constrainXOrbit)this.orbitX=Math.min(Math.max(this.orbitX,this.minOrbitX),this.maxOrbitX);else{while(this.orbitX<-Math.PI)this.orbitX+=Math.PI*2;while(this.orbitX>=Math.PI)this.orbitX-=Math.PI*2}this._dirty=!0}},t.prototype.getCenter=function(){return[-this._center[0],-this._center[1],-this._center[2]]},t.prototype.setCenter=function(e){this._center[0]=-e[0],this._center[1]=-e[1],this._center[2]=-e[2],this._dirty=!0},t.prototype.getDistance=function(){return-this._distance[2]},t.prototype.setDistance=function(e){this._distance[2]=-e,this.constrainDistance&&(this._distance[2]=Math.min(Math.max(-this._distance[2],this.minDistance),this.maxDistance)*-1),this._dirty=!0},t.prototype.getYUp=function(){return this._yUp},t.prototype.setYUp=function(e){this._yUp=e,this._dirty=!0},t.prototype.setCenter=function(e){this._center[0]=-e[0],this._center[1]=-e[1],this._center[2]=-e[2],this._dirty=!0},t.prototype.getViewMat=function(){if(this._dirty){var e=this._viewMat;mat4.identity(e),mat4.translate(e,this._distance),mat4.rotateX(e,this.orbitX),mat4.rotateY(e,this.orbitY),mat4.rotateX(e,-Math.PI*.5),mat4.translate(e,this._center),this._yUp||mat4.rotateX(e,Math.PI*.5),this._dirty=!1}return this._viewMat},t.prototype.update=function(){var e,t;for(t=0;t<navigator.gamepads.length;++t)e=navigator.gamepads[t],e&&(e.id.indexOf("Space Navigator")!=-1?this.orbit(r(e.axes[4])*-0.05,r(e.axes[3])*-0.05):(this.orbit(r(e.axes[0])*.05,r(e.axes[1])*.05),this.orbit(r(e.axes[2])*.05,r(e.axes[3])*.05)))},n=function(e){this._angles=vec2.create(),this._position=vec3.create(),this.speed=100,this._pressedKeys=new Array(128),this._viewMat=mat4.create(),this._rotMat=mat4.create(),this._dirty=!0,this._hookEvents(e)},n.prototype._hookEvents=function(e){var t=this,n=!1,r,i;e.tabIndex=0,e.addEventListener("keydown",function(e){t._pressedKeys[e.keyCode]=!0;if(e.keyCode==32)return e.preventDefault(),!1},!0),e.addEventListener("keyup",function(e){t._pressedKeys[e.keyCode]=!1},!1),e.addEventListener("mousedown",function(e){e.which===1&&(n=!0),r=e.pageX,i=e.pageY},!1),e.addEventListener("mousemove",function(e){var s,o;document.pointerLockEnabled?(s=e.movementX,o=e.movementY,t.rotateView(s*.025,o*.025)):n&&(s=e.pageX-r,o=e.pageY-i,r=e.pageX,i=e.pageY,t.rotateView(s*.025,o*.025))},!1),e.addEventListener("mouseup",function(){n=!1},!1)},n.prototype.rotateView=function(e,t){var n=this._rotMat;if(e||t){this._angles[1]+=e;while(this._angles[1]<0)this._angles[1]+=Math.PI*2;while(this._angles[1]>=Math.PI*2)this._angles[1]-=Math.PI*2;this._angles[0]+=t,this._angles[0]<-Math.PI*.5&&(this._angles[0]=-Math.PI*.5),this._angles[0]>Math.PI*.5&&(this._angles[0]=Math.PI*.5),mat4.identity(n),mat4.rotateZ(n,-this._angles[1]),mat4.rotateX(n,-this._angles[0]),this._dirty=!0}},n.prototype.getAngles=function(){return[this._angles[0],this._angles[1]]},n.prototype.setAngles=function(e){this._angles[0]=e[0],this._angles[1]=e[1],this._dirty=!0},n.prototype.getPosition=function(){return[this._position[0],this._position[1],this._position[2]]},n.prototype.setPosition=function(e){this._position[0]=e[0],this._position[1]=e[1],this._position[2]=e[2],this._dirty=!0},n.prototype.getViewMat=function(){if(this._dirty){var e=this._viewMat;mat4.identity(e),mat4.rotateX(e,-Math.PI*.5),mat4.rotateX(e,this._angles[0]),mat4.rotateZ(e,this._angles[1]),mat4.translate(e,[-this._position[0],-this._position[1],-this._position[2]]),this._dirty=!1}return this._viewMat},n.prototype.update=function(e){var t=vec3.create(),n=this.speed/1e3*e,i,s;this._pressedKeys["W".charCodeAt(0)]&&(t[1]+=n),this._pressedKeys["S".charCodeAt(0)]&&(t[1]-=n),this._pressedKeys["A".charCodeAt(0)]&&(t[0]-=n),this._pressedKeys["D".charCodeAt(0)]&&(t[0]+=n),this._pressedKeys[32]&&(t[2]+=n),this._pressedKeys[17]&&(t[2]-=n);for(s=0;s<navigator.gamepads.length;++s)i=navigator.gamepads[s],i&&(i.id.indexOf("Space Navigator")!=-1?(t[0]+=r(i.axes[0])*n,t[1]+=r(i.axes[1])*-n,t[2]+=r(i.axes[2])*-n,this.rotateView(r(i.axes[4])*.05,r(i.axes[3])*-0.05)):(t[0]+=r(i.axes[0])*n,t[1]+=r(i.axes[1])*n,this.rotateView(r(i.axes[2])*.05,r(i.axes[3])*.05)));if(t[0]!==0||t[1]!==0||t[2]!==0)mat4.multiplyVec3(this._rotMat,t),vec3.add(this._position,t),this._dirty=!0},{OrbitCamera:t,FlyingCamera:n}})